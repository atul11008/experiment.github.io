<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width">
        <title>Peer-to-Peer Cue System --- Sender</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js">
        </script>
        <script type="text/javascript" src="paint.js"></script>
        <script type="text/javascript" src="init.js"></script>    
          </head>
          <body>
            <div id="container" style="padding:5px 0px 0px 0px;">
        <div id="colorToolbar" style="border: 1px solid black; float: left;"> 
        <div id="red" style="background:red; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="pink" style="background:pink; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="fuchsia" style="background:fuchsia; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="orange" style="background:orange; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="yellow" style="background:yellow; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="lime" style="background:lime; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="green" style="background:green; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="blue" style="background:blue; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="purple" style="background:purple; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
        <div id="black" style="background:black; width:50px; height:50px; 
        float:left; border: 1px dashed white;"></div>
        <div style="clear: both;"></div> 
        <div id="white" style="background:white; width:50px; height:50px; float:left;"></div>
        <div style="clear: both;"></div> 
                    <hr/> 
        <div id="fill" style="width:50px; height:50px; float:left;">
        <img src="fill.png" width="50" height="50" /></div>
        <div style="clear: both;"></div> 
        <div id="cat" style="width:50px; height:50px; float:left;">
        <img id="catImg" src="cat.png" width="50" height="50" /></div>
        <div style="clear: both;"></div> 
        <div id="dog" style="width:50px; height:50px; float:left;">
        <img id="dogImg" src="dog.png" width="50" height="50" /></div>
        <div style="clear: both;"></div> 
        <div id="dragonfly" style="width:50px; height:50px; float:left;">
        <img id="dragonFlyImg" src="fly.png" width="50" height="50" /></div>
        <div style="clear: both;"></div> 
        <div id="ladybug" style="width:50px; height:50px; float:left;">
        <img id="ladyBugImg" src="bug.png" width="50" height="50" /></div>
        <div style="clear: both;"></div> 
        <div id="heart" style="width:50px; height:50px; float:left;">
        <img id="heartImg" src="heart.png" width="50" height="50" /></div>
        <div style="clear: both;"></div> 
        <div id="save" style="width:50px; height:50px; float:left;">Save</div>
        <div style="clear: both;"></div> 
                </div> 
                <div id="canvasDiv" style="float: left;">
                  <canvas id="imageView">
                    <p>Unfortunately, your browser is currently unsupported by our web 
                    application.  We are sorry for the inconvenience. Please use one of the 
                    supported browsers listed below, or draw the image you want using an 
                    offline tool.</p>
                    <p>Supported browsers: <a href="http://www.opera.com">Opera</a>, <a 
                      href="http://www.mozilla.com">Firefox</a>, <a 
                      href="http://www.apple.com/safari">Safari</a>, and <a 
                      href="http://www.konqueror.org">Konqueror</a>.</p>
                  </canvas>        
                </div>
        <div id="stats" style="font-size:8pt; padding-left: 50px; float: left;">0 0</div>        
            </div>  
        <script>
            if (window.addEventListener) {
   window.addEventListener('load', function() { init(); });
}
var started = false;
var canvas, context;
var stampId = '';
var lastColor = 'black';
var lastStampId = '';

function init() {
    canvas = $('#imageView').get(0);
    context = canvas.getContext('2d');

    // Auto-adjust canvas size to fit window.
    canvas.width  = window.innerWidth - 75;
    canvas.height = window.innerHeight - 75;

    canvas.addEventListener('mousemove', onMouseMove, false);
    canvas.addEventListener('click', onClick, false);

    // Add events for toolbar buttons.
    $('#red').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#pink').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#fuchsia').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#orange').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#yellow').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#lime').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#green').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#blue').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#purple').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#black').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#white').get(0).addEventListener('click', function(e) { 
     onColorClick(e.target.id); }, false);
    $('#cat').get(0).addEventListener('click', function(e) { 
     onStamp(e.target.id); }, false);
    $('#dragonfly').get(0).addEventListener('click', function(e) { 
     onStamp(e.target.id); }, false);
    $('#ladybug').get(0).addEventListener('click', function(e) { 
     onStamp(e.target.id); }, false);
    $('#heart').get(0).addEventListener('click', function(e) { 
     onStamp(e.target.id); }, false);
    $('#dog').get(0).addEventListener('click', function(e) { 
     onStamp(e.target.id); }, false);
    $('#fill').get(0).addEventListener('click', function(e) { onFill(); }, false);
    $('#save').get(0).addEventListener('click', function(e) { onSave(); }, false);
}
function onMouseMove(ev) {
    var x, y;

    // Get the mouse position.
    if (ev.layerX >= 0) {
        // Firefox
        x = ev.layerX - 50;
        y = ev.layerY - 5;
    }
    else if (ev.offsetX >= 0) {
        // Opera
        x = ev.offsetX - 50;
        y = ev.offsetY - 5;
    }

    if (!started) {
        started = true;

        context.beginPath();
        context.moveTo(x, y);        
    }
    else {
        context.lineTo(x, y);
        context.stroke();
    }

    $('#stats').text(x + ', ' + y);
}
function onClick(e) {
    if (stampId.length > 0) {
        context.drawImage($(stampId).get(0), e.pageX - 90, e.pageY - 60, 80, 80);
    }
}
        </script>
        <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
        <script type="text/javascript">
            var lastPeerId = null;
    var peer = null; // own peer object
    var conn = null;
            // Find the canvas element to capture
var canvasElt = document.getElementById('imageView');

// Get the stream
var stream = canvasElt.captureStream(25); // 25 FPS

// Do things to the stream
// E.g. Send it to another computer using an RTCPeerConnection
//      pc is an RTCPeerConnection created elsewhere
pc.addStream(stream);
        </script>
    </body>
</html>
